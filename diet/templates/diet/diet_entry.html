{% load static %}

<div class="diet-assessment">
    <h1>Nutrition Planning Assessment</h1>

    {% if request.GET.from_meal_planning %}
    <div class="navigation-buttons">
        <a href="{% url 'diet:meal_planning' %}" class="button outline">‚Üê Back to Current Plan</a>
    </div>
    {% endif %}

    <div class="progress-bar">
        <div class="step {% if current_step >= 1 %}active{% endif %} {% if current_step > 1 %}complete{% endif %}">
            1. Dietary Restrictions & Health Considerations
        </div>
        <div class="step {% if current_step >= 2 %}active{% endif %} {% if current_step > 2 %}complete{% endif %}">
            2. Current Food Habits
        </div>
        <div class="step {% if current_step >= 3 %}active{% endif %} {% if current_step == 'complete' %}complete{% endif %}">
            3. Meal Timing
        </div>
    </div>

    {% if message %}
    <div class="alert success">{{ message }}</div>
    {% endif %}
    {% if error %}
    <div class="alert error">{{ error }}</div>
    {% endif %}

    {% if current_step == "complete" %}
        <div class="completion-message">
            <h2>Assessment Complete!</h2>
            <p>Based on your input and health goals, we can now create personalized meal plans for you.</p>
            {% if ready_for_planning %}
            <a href="{% url 'diet:meal_planning' %}" class="button primary">Start Meal Planning</a>
            {% endif %}
            <form method="post" action="{% url 'diet:reset_preferences' %}" style="margin-top: 20px;">
                {% csrf_token %}
                <button type="submit" class="button secondary">Start Over</button>
            </form>
        </div>
    {% else %}
        <div class="step-container">
            {% if current_step == 1 %}
            <div class="step-content">
                <h2>Step 1: Dietary Restrictions & Health Considerations</h2>
                <p>Please tell us about any dietary restrictions, allergies, or foods you avoid. For example:</p>
                <ul>
                    <li>Any specific diet you follow or need to follow (vegetarian, vegan, keto, etc.)</li>
                    <li>Food allergies or intolerances</li>
                    <li>Foods you absolutely won't or can't eat</li>
                </ul>
            </div>
            {% elif current_step == 2 %}
            <div class="step-content">
                <h2>Step 2: Current Food Habits</h2>
                <p>Tell us about your typical meals and food choices. For example:</p>
                <ul>
                    <li>What types of food you typically eat</li>
                    <li>Dishes you commonly prepare or order</li>
                    <li>Any comfort foods or regular meals in your diet</li>
                </ul>
            </div>
            {% elif current_step == 3 %}
            <div class="step-content">
                <h2>Step 3: Meal Timing</h2>
                <p>Help us understand your eating schedule:</p>
                <ul>
                    <li>How many meals you typically have per day</li>
                    <li>Your usual meal times</li>
                    <li>Any specific meal patterns (intermittent fasting, etc.)</li>
                </ul>
            </div>
            {% endif %}

            <form method="post" class="step-form">
                {% csrf_token %}
                {{ form.as_p }}
                <input type="hidden" name="step" value="{{ current_step }}" />
                <button type="submit" class="button primary">Continue</button>
            </form>
        </div>

        {% if prefs %}
        <div class="current-preferences">
            <h3>Dietary Analysis & Recommendations</h3>
            <div class="preferences-grid">
                {% if prefs.dietary_tags %}
                <div class="pref-section">
                    <h4>Dietary Considerations</h4>
                    <ul>
                        {% for tag in prefs.dietary_tags %}
                        <li>{{ tag }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

                {% if prefs.allergies %}
                <div class="pref-section">
                    <h4>Health & Safety Restrictions</h4>
                    <ul>
                        {% for allergy in prefs.allergies %}
                        <li>{{ allergy }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

                {% if prefs.preferred_cuisines %}
                <div class="pref-section">
                    <h4>Recommended Cuisines</h4>
                    <p class="recommendation-note">Based on your eating habits and health goals, these cuisines might work well for you:</p>
                    <ul>
                        {% for cuisine in prefs.preferred_cuisines %}
                        <li>{{ cuisine }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

                {% if prefs.preferred_meal_times %}
                <div class="pref-section">
                    <h4>Suggested Meal Schedule</h4>
                    <p>Recommended meals per day: {{ prefs.meals_per_day }}</p>
                    <p class="recommendation-note">Suggested meal times based on your schedule:</p>
                    <ul>
                        {% for time in prefs.preferred_meal_times %}
                        <li>{{ time }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}
    {% endif %}

    {% if health_goals %}
    <div class="health-context">
        <h3>Your Health Goals</h3>
        <div class="goals-summary">
            {% if health_goals.goal_category %}
            <p><strong>Primary Goal:</strong> {{ health_goals.goal_category }}</p>
            {% endif %}
            {% if health_goals.lifestyle_category %}
            <p><strong>Lifestyle:</strong> {{ health_goals.lifestyle_category }}</p>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>

<style>
.diet-assessment {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
}

.navigation-buttons {
    margin-bottom: 20px;
    padding: 10px 0;
}

.button.outline {
    background: transparent;
    border: 2px solid #6c757d;
    color: #6c757d;
    transition: all 0.3s ease;
}

.button.outline:hover {
    background: #6c757d;
    color: white;
}

.progress-bar {
    display: flex;
    justify-content: space-between;
    margin-bottom: 30px;
    padding: 10px 0;
}

.step {
    flex: 1;
    text-align: center;
    padding: 10px;
    margin: 0 5px;
    background: #f0f0f0;
    border-radius: 5px;
    opacity: 0.5;
}

.step.active {
    background: #007bff;
    color: white;
    opacity: 1;
}

.step.complete {
    background: #28a745;
    color: white;
    opacity: 1;
}

.alert {
    padding: 15px;
    margin-bottom: 20px;
    border-radius: 5px;
}

.alert.success {
    background: #d4edda;
    color: #155724;
}

.alert.error {
    background: #f8d7da;
    color: #721c24;
}

.step-container {
    background: white;
    padding: 20px;
    border-radius: 5px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.step-content ul {
    margin-left: 20px;
    margin-bottom: 20px;
}

.button {
    padding: 10px 20px;
    border-radius: 5px;
    border: none;
    cursor: pointer;
    font-size: 16px;
}

.button.primary {
    background: #007bff;
    color: white;
}

.button.secondary {
    background: #6c757d;
    color: white;
}

.preferences-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.pref-section {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 5px;
}

.pref-section ul {
    margin-left: 20px;
    margin-top: 10px;
}

.health-context {
    margin-top: 30px;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 5px;
}

.completion-message {
    text-align: center;
    padding: 40px 20px;
}

.recommendation-note {
    font-size: 0.9em;
    color: #666;
    margin-bottom: 10px;
    font-style: italic;
}
</style>